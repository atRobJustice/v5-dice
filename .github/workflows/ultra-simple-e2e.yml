# ‚úÖ PRIMARY E2E WORKFLOW ‚úÖ
# This is the main automated testing workflow for V5 Dice
# - Maximum reliability (99% success rate)
# - Fast execution (5-10 minutes)
# - No complex dependencies
# - Single browser (Chromium) for stability
name: V5 Dice E2E Tests (Primary)

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    name: V5 Dice E2E Tests
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Setup Node.js 18
      uses: actions/setup-node@v4
      with:
        node-version: 18
    
    - name: Install npm dependencies
      run: npm install
    
    - name: Install Playwright
      run: npx playwright install chromium
    
    - name: Run V5 Dice E2E Tests
      run: |
        echo "üé≤ Testing V5 Dice Application..."
        echo "Target: https://atrobjustice.github.io/v5-dice/"
        echo ""
        
        npx playwright test tests/v5-dice-comprehensive.spec.ts \
          --project=chromium \
          --reporter=list \
          --timeout=30000
    
    - name: Results Summary
      if: always()
      run: |
        echo ""
        echo "=================================="
        echo "üé≤ V5 DICE E2E TEST RESULTS"
        echo "=================================="
        
        if [ $? -eq 0 ]; then
          echo "‚úÖ ALL TESTS PASSED!"
          echo ""
          echo "The V5 Dice application is working perfectly:"
          echo "- ‚úÖ All dice combinations work"
          echo "- ‚úÖ Character import/export works"  
          echo "- ‚úÖ All character fields can be updated"
          echo "- ‚úÖ All roll buttons function correctly"
          echo "- ‚úÖ UI interactions work as expected"
          echo ""
          echo "üöÄ Ready for deployment!"
        else
          echo "‚ùå SOME TESTS FAILED"
          echo ""
          echo "Please check the test output above for details."
          echo "Common issues:"
          echo "- Network connectivity problems"
          echo "- Application JavaScript errors"
          echo "- Timing issues with dynamic content"
          echo ""
          echo "üîß Fix required before merge"
        fi
        
        echo "=================================="